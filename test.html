<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="mango_script.js"></script>		
	</head>
<body>	
<h2>SCRIPT</h2>
<pre id="code">
Mango = createMango({copy:'deepCopy'})();		
var arr = [{name:'Bill',age:10,addr:{country:'US',town:'Washington'}},
{name:'Joe',age:14,addr:{country:'England',town:'London'}},
{name:'Luke',age:26,ip:[192,168,1,1]},{name:'Joana',age:21,ip:[192,168,1,2]}];

var query1 = {name:'Bill',age:10};
var query2 = {age:{$gt:10,$lte:21}};
var query3 = {$or:{name:'Bill',age:14}};
var query4 = {name:/jo.*/i};
var query5 = {'addr.country':{$in:['US','England']}};
var query7 = {ip:{$exists:true}};
var options1 = {skip:1,limit:2};
var options2 = {fields:{name:1}};
var html = ""; 
				
document.getElementById('source').innerHTML = ''+"Source Array:\n"+print_r(arr)+'';

html += "\nquery1 ({name:'Bill',age:10})\n"+print_r(Mango.find(arr,query1));
html += "\nquery2 ({age:{$gt:10,$lte:21}})\n"+print_r(Mango.find(arr,query2));
html += "\nquery3 ({$or:{name:'Bill',age:14}})\n"+print_r(Mango.find(arr,query3));
html += "\nquery4 ({name:/jo.*/i})\n"+print_r(Mango.find(arr,query4));
html += "\nquery5 ({'addr.country':{$in:['US','England']}})\n"+print_r(Mango.find(arr,query5));

Mango({proto:true});

html += "\nquery6 ({},{skip:1,limit:2})\n"+print_r(arr.find({},options1));
html += "\nquery7 ({ip:{$exists:true}},{fields:{name:1}})\n"+print_r(arr.find(query7,options2));

document.getElementById('result').innerHTML = ''+html+'';
</pre>
<div id="source" style="position:fixed;right:200px; top:50px"></div>
<h2>RESULT</h2>
<div id="result"></div>
	<script type="text/javascript">
/**
 * Concatenates the values of a variable into an easily readable string
 * by Matt Hackett [scriptnode.com]
 * @param {Object} x The variable to debug
 * @param {Number} max The maximum number of recursions allowed (keep low, around 5 for HTML elements to prevent errors) [default: 10]
 * @param {String} sep The separator to use between [default: a single space ' ']
 * @param {Number} l The current level deep (amount of recursion). Do not use this parameter: it's for the function's own use
 */
function print_r(x, max, sep, l) {

	l = l || 0;
	max = max || 10;
	sep = sep || ' ';

	if (l > max) {
		return "[WARNING: Too much recursion]\n";
	}

	var
		i,
		r = '',
		t = typeof x,
		tab = '';
	if(t == 'function')
		return "prototype function\n";
	if (x === null) {
		r += "(null)\n";
	} else if (t == 'object') {

		l++;

		for (i = 0; i < l; i++) {
			tab += sep;
		}

		if (x && x.length) {
			t = 'array';
		}

		r += '(' + t + ") :\n";

		for (i in x) {
			try {
				r += tab + '[' + i + '] : ' + print_r(x[i], max, sep, (l + 1));
			} catch(e) {
				return "[ERROR: " + e + "]\n";
			}
		}

	} else {

		if (t == 'string') {
			if (x == '') {
				x = '(empty)';
			}
		}

		r += '(' + t + ') ' + x + "\n";

	}
	return r;	
};

//TEST	
		Mango = createMango({copy:'deepCopy'})();		
		var arr = [{name:'Bill',age:10,addr:{country:'US',town:'Washington'}},{name:'Joe',age:14,addr:{country:'England',town:'London'}},{name:'Luke',age:26,ip:[192,168,1,1]},{name:'Joana',age:21,ip:[192,168,1,2]}];
		var query1 = {name:'Bill',age:10};
		var query2 = {age:{$gt:10,$lte:21}};
		var query3 = {$or:{name:'Bill',age:14}};
		var query4 = {name:/jo.*/i};
		var query5 = {'addr.country':{$in:['US','England']}};
		var query7 = {ip:{$exists:true}};
		var options1 = {skip:1,limit:2};
		var options2 = {fields:{name:1}};
		var html = ""; 
						
		document.getElementById('source').innerHTML = '<pre>'+"<b>Source Array:</b>\n"+print_r(arr)+'</pre>';
		
		html += "\n<b>query1 ({name:'Bill',age:10})</b>\n"+print_r(Mango.find(arr,query1));
		html += "\n<b>query2 ({age:{$gt:10,$lte:21}})</b>\n"+print_r(Mango.find(arr,query2));
		html += "\n<b>query3 ({$or:{name:'Bill',age:14}})</b>\n"+print_r(Mango.find(arr,query3));
		html += "\n<b>query4 ({name:/jo.*/i})</b>\n"+print_r(Mango.find(arr,query4));
		html += "\n<b>query5 ({'addr.country':{$in:['US','England']}})</b>\n"+print_r(Mango.find(arr,query5));
		
		Mango({proto:true});
		
		html += "\n<b>query6 ({},{skip:1,limit:2})</b>\n"+print_r(arr.find({},options1));
		html += "\n<b>query7 ({ip:{$exists:true}},{fields:{name:1}})</b>\n"+print_r(arr.find(query7,options2));
		
		document.getElementById('result').innerHTML = '<pre>'+html+'</pre>';				
	</script>
</body>
</html>	